<% @purchase = Purchase.new %>
<% @purchase.errors.full_messages.each do |error| %>
  <%= error %><br>
<% end %>
<br>
<% @order = Order.find(params[:order_id])  %>
<p class='purchasediv'>You are placing an order with
<%= @order.products.count %> 
<%= 'different item'.pluralize %></p>
<br>
<p>This order will cost you AT LEAST
  <% sum = 0 %>
<% @order.products.each do |product| %>
  <% @order_item = OrderItem.where(product_id: product.id, order_id: @order.id)[0] %>
  <% sum += product.price * @order_item.quantity %>
<% end %>
<%= number_to_currency(sum/100) %>
plus shipping, handling, and any hidden fees. </p>
<% @purchase.errors.full_messages.each do |error| %>
<br>
<%= error %>
<% end %>
<%= form_for @purchase do |f| %>
  <h3>Shipping Address</h3>
  <%= f.label 'First Name'%>
    <%= f.text_field :first_name%><br>
  <%= f.label "Last Name"%>
    <%= f.text_field :last_name%><br>
  <%= f.label "Address"%>
    <%= f.text_field :address1 %><br>  
  <%= f.label "Address (line 2)"%>
    <%= f.text_field :address2%><br>
  <%= f.label "City"%>
    <%= f.text_field :city%>
  <%= f.label "State"%>
    <%= f.select :state, us_states%>
  <%= f.label "Zip"%>
    <%= f.text_field :zip%><br>
  <%= f.label "Email Address"%>  
    <%= f.text_field :email_address%><br>
  <%= f.label "Confirm Email Address"%>
    <%= f.text_field :email_address_confirmation%><br>
  <br>
  <h3>Billing Information</h3>
  <br>
  <div id="samebilling">
  <%= f.label 'Same as Shipping Address' %>
  <%= f.check_box :same_address %>
</div>
  <br><br>
  <div class="billingdeets">
  <%= f.label 'First Name' %>
    <%= f.text_field :billing_first%><br>
  <%= f.label "Last Name" %>
    <%= f.text_field :billing_last%><br>
  </div>
  <%= f.label "Credit Card Number" %>
    <%= f.text_field :credit_card_number%><br>
  <%= f.label "CVV" %>
    <%= f.text_field :cvv%><br>
  <%= f.label "Expiration Date" %>
    <%= f.text_field :expiration_date%><br>
  <div class="billingdeets">
  <%= f.label "Address"%>
    <%= f.text_field :billing_address1%><br>  
  <%= f.label "Address (line 2)"%>
    <%= f.text_field :billing_address2%><br>
  <%= f.label "City"%>
    <%= f.text_field :billing_city%>
  <%= f.label "State"%>
    <%= f.select :billing_state, us_states%>
  <%= f.label "Zip"%>
    <%= f.text_field :billing_zip%>
  <%= hidden_field_tag :order_id, @order.id %>
  </div>
  <br>
  <%= f.submit "Place Order" %>
<% end %>