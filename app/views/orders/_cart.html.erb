<h2>Your Cart</h2>
<br>
<% @order.errors.full_messages.each do |error| %>
  <%= error %><br>
<% end %>

<table class="cart">
  <thead>
    <tr>
      <th scope="item">Item</th>
      <th scope="qty">Quantity</th>
      <th></th>
      <th></th>
      <th scope="price">Price</th>
      <th scope="sub">Subtotal</th>
    </tr>
  </thead>

  <% subtotal = 0 %>
  <tbody>
    <%@order.products.each do |product| %>
      <tr>
        <td><%= image_tag(product.image_url, width: 30, height: 30) if product.image.present? %>
          <%= link_to product.name, product %></td>
        <% @order_item = OrderItem.where(product_id: product.id, order_id: @order.id)[0] %>
        <td><%= form_for @order, :url => {:controller => 'orders', :action => 'update_quantity'} do |f| %>
              <div class="field">
                <%= f.hidden_field :product_id, :value => product.id %>
                <%= f.number_field :quantity, :value => @order_item.quantity %>
                <%= submit_tag "Update" %>
              </div>
            <% end %>


        <td><%= price_format(product.price) %></td>
        <% subtotal += product.price * @order_item.quantity %>
        <td><%= price_format(subtotal) %></td>
      </tr>
    <% end %>
  </tbody>
</table>s

<h3>Your total: <%= price_format(subtotal) %></h3>
<div class = 'checkout'>
<%= form_tag('/orders/check_order_quantities') do %>
  <%= hidden_field_tag :order_id, @order.id %>
  <%= submit_tag 'Checkout' %>
<% end %>
</div>

